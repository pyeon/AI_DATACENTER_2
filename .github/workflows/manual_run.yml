name: ğŸ¯ Manual Run (ìˆ˜ë™ ì‹¤í–‰)

on:
  workflow_dispatch:
    inputs:
      task:
        description: 'ì‹¤í–‰í•  ì‘ì—… ì„ íƒ'
        required: true
        type: choice
        options:
          - daily_report
          - stock_selection
          - both
        default: 'daily_report'

jobs:
  manual-run:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v5
      
      - name: ğŸ Python 3.10 ì„¤ì •
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
      
      - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸ“‚ ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
        run: mkdir -p outputs
      
      - name: ğŸ“Š ì¼ì¼ ë¦¬í¬íŠ¸ ì‹¤í–‰
        if: ${{ github.event.inputs.task == 'daily_report' || github.event.inputs.task == 'both' }}
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ğŸ“Š ì¼ì¼ ë¦¬í¬íŠ¸ ì‹¤í–‰ ì¤‘..."
          python scripts/datacenter_report_enhanced.py
          echo "âœ… ì¼ì¼ ë¦¬í¬íŠ¸ ì™„ë£Œ"
      
      - name: ğŸ” ì¢…ëª© ì„ ì • ì‹¤í–‰
        if: ${{ github.event.inputs.task == 'stock_selection' || github.event.inputs.task == 'both' }}
        run: |
          echo "ğŸ” ì¢…ëª© ì„ ì • ì‹¤í–‰ ì¤‘..."
          python scripts/stock_selection_system.py
          echo "âœ… ì¢…ëª© ì„ ì • ì™„ë£Œ"
      
      - name: ğŸ“ ê²°ê³¼ íŒŒì¼ ì—…ë¡œë“œ (Artifacts)
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: manual-run-${{ github.run_number }}
          path: outputs/*.xlsx
          retention-days: 30
      
      - name: âœ… ì™„ë£Œ ë©”ì‹œì§€
        run: |
          echo "âœ… ìˆ˜ë™ ì‹¤í–‰ ì™„ë£Œ!"
          echo "ğŸ“ ì„ íƒí•œ ì‘ì—…: ${{ github.event.inputs.task }}"
          echo "ğŸ“¥ Artifacts íƒ­ì—ì„œ ê²°ê³¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥"
          
          if [ "${{ github.event.inputs.task }}" == "daily_report" ] || [ "${{ github.event.inputs.task }}" == "both" ]; then
            echo "ğŸ“± í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ"
          fi
